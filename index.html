<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Factory Daily Summary</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>

<body style="font-family: Arial; padding:20px">

<h2>Factory Daily Summary (8AM Shift)</h2>

<table border="1" cellpadding="8">
  <thead>
    <tr>
      <th>Shift Date</th>
      <th>Trucks Count</th>
      <th>Total Beet Weight</th>
      <th>Total Net Weight</th>
      <th>Weighted Sugar %</th>
      <th>Weighted Tare %</th>
    </tr>
  </thead>
  <tbody id="data"></tbody>
</table>

<script>
  // بيانات Supabase
  const SUPABASE_URL = 'https://geqnjkkztgpvkobmmdhi.supabase.co'
  const SUPABASE_KEY = 'sb_publishable_209O2YA7JfbXcJ-FFqvLFQ_kYZpEunc'

  const supabaseClient = window.supabase.createClient(
    SUPABASE_URL,
    SUPABASE_KEY
  )

  async function loadData() {

    const { data, error } = await supabaseClient
      .from('deliveries_summary')
      .select('*')
      .order('shift_date_unloading', { ascending: true })

    console.log('DATA:', data)
    console.log('ERROR:', error)

    if (error) {
      alert(error.message)
      return
    }

    const tbody = document.getElementById('data')
    tbody.innerHTML = ''

    data.forEach(row => {
      const tr = document.createElement('tr')
      tr.innerHTML = `
        <td>${row.shift_date_unloading}</td>
        <td>${row.trucks_count}</td>
        <td>${Number(row.total_beet_weight).toFixed(2)}</td>
        <td>${Number(row.total_net_weight).toFixed(2)}</td>
        <td>${Number(row.weighted_sugar_percent).toFixed(2)}</td>
        <td>${Number(row.weighted_tare_percent).toFixed(2)}</td>
      `
      tbody.appendChild(tr)
    })
  }

  loadData()
</script>

</body>
</html>
